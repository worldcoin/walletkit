name: "Rust Setup"
description: "Sets up Rust environment with caching and dependencies"

inputs:
  cache-prefix:
    description: "Prefix for cache keys"
    required: true

runs:
  using: composite
  steps:
    - shell: bash
      run: |
        rustup update
        rustup target add aarch64-apple-ios-sim
        rustup target add aarch64-apple-ios
        rustup target add x86_64-apple-ios
        rustup target add x86_64-unknown-linux-gnu
        rustup target add armv7-linux-androideabi
        rustup target add aarch64-linux-android
        rustup target add x86_64-linux-android
        rustup target add i686-linux-android

    - shell: bash
      run: cargo fetch

    - uses: actions/cache@v4
      with:
        path: ~/.cargo/registry
        key: ${{ runner.os }}-cargo-registry-${{ hashFiles('**/Cargo.lock') }}
        restore-keys: ${{ runner.os }}-cargo-registry-

    - uses: actions/cache@v4
      with:
        path: ~/.cargo/git
        key: ${{ runner.os }}-cargo-index-${{ hashFiles('**/Cargo.lock') }}
        restore-keys: ${{ runner.os }}-cargo-index-

    - uses: actions/cache@v4
      with:
        path: target
        key: ${{ runner.os }}-cargo-${{ inputs.cache-prefix }}-${{ hashFiles('**/Cargo.lock') }}
        restore-keys: ${{ runner.os }}-cargo-${{ inputs.cache-prefix }}-
