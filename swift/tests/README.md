# WalletKit Swift Foreign Binding Tests

This directory contains Swift tests that verify the FFI (Foreign Function Interface) bindings between Rust and Swift work correctly.

## Structure

```
swift/tests/
├── Package.swift                    # Swift Package Manager configuration
├── Sources/WalletKit/              # Swift bindings (copied from build)
│   ├── walletkit.swift             # Generated by UniFFI
│   └── walletkit_core.swift        # Generated by UniFFI
└── WalletKitTests/                 # Test files
    └── AuthenticatorTests.swift    # Foreign binding tests
```

## Prerequisites

Before running tests, you must build the Swift bindings:

```bash
# From the walletkit root directory
./build_swift.sh
```

This will:
1. Build the Rust library for iOS targets
2. Generate Swift bindings via UniFFI
3. Create WalletKit.xcframework
4. Copy Swift files to Sources/WalletKit/

## Running Tests

After building, you can run the tests:

```bash
# From the walletkit root directory
cd swift/tests
swift test
```

Or run specific tests:

```bash
swift test --filter testU256WrapperFromU64
swift test --filter AuthenticatorTests
```

## What These Tests Verify

1. **U256Wrapper**: Number type conversions across FFI boundary
   - Creating from u64, decimal strings, hex strings
   - Error handling for invalid inputs

2. **Authenticator**: Core functionality
   - Initialization with different parameters
   - Error handling (InvalidSeed, InvalidRpcUrl, AccountDoesNotExist)
   - Environment switching

3. **FFI Boundary**: Type marshalling
   - Rust types properly exposed to Swift
   - Error types correctly propagated
   - Async functions work across FFI

## Test Philosophy

These are **foreign binding tests**, not unit tests:
- Focus on verifying FFI layer works correctly
- Test type conversions and error propagation
- Ensure async Rust functions callable from Swift
- Validate error enum marshalling

For Rust logic tests, see `walletkit-core/tests/`.

## Updating Tests

When you add new Rust types or functions:

1. Add `#[derive(uniffi::Object)]` or `#[uniffi::export]` in Rust
2. Rebuild with `./build_swift.sh`
3. Add corresponding Swift tests here
4. Run `swift test` to verify

## Notes

- Tests reference the local `WalletKit.xcframework` (see Package.swift)
- Swift files are copied from the build output
- This follows the same pattern as Bedrock's foreign binding tests
